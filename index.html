<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Minha Biblioteca</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .search-container {
            display: flex;
            margin: 15px 0;
        }

        .search-container input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px 0 0 4px;
            background: #333;
            color: white;
        }

        .search-container button {
            padding: 8px 12px;
            background: #1DB954;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            color: white;
        }

        .card {
            position: relative;
        }

        .play-btn,
        .follow-btn,
        .edit-playlist,
        .delete-playlist {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: #1DB954;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: white;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover .play-btn,
        .card:hover .follow-btn,
        .card:hover .edit-playlist,
        .card:hover .delete-playlist {
            opacity: 1;
        }

        .edit-playlist,
        .delete-playlist {
            border-radius: 15px;
            width: auto;
            padding: 0 10px;
            font-size: 0.8rem;
        }

        .delete-playlist {
            background: #e74c3c;
            bottom: 50px;
        }
    </style>
</head>
<!-- Player de M√∫sica -->
<div id="musicPlayer" class="music-player">
    <div class="player-info">
        <img id="playerAlbumCover" src="" alt="Album Cover" class="player-album-cover">
        <div class="player-details">
            <h4 id="playerSongTitle">M√∫sica</h4>
            <p id="playerArtist">Artista</p>
        </div>
    </div>

    <div class="player-controls">
        <button class="control-btn" onclick="previousSong()">‚èÆ</button>
        <button class="control-btn" onclick="togglePlay()" id="playPauseBtn">‚ñ∂</button>
        <button class="control-btn" onclick="nextSong()">‚è≠</button>
    </div>

    <div class="progress-container">
        <span class="time-display" id="currentTime">0:00</span>
        <div class="progress-bar" onclick="seekSong(event)">
            <div class="progress" id="songProgress"></div>
        </div>
        <span class="time-display" id="totalTime">0:00</span>
    </div>

    <div class="volume-control">
        <span>üîä</span>
        <div class="volume-bar" onclick="changeVolume(event)">
            <div class="volume-level" id="volumeLevel"></div>
        </div>
    </div>
</div>

<!-- √Åudio invis√≠vel -->
<audio id="audioPlayer" preload="metadata"></audio>

<body>
    <div class="home-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Minha Biblioteca</h2>
            <button id="criarPlaylistBtn">Criar playlist</button>
            <button id="explorePodcastsBtn">Explore podcasts</button>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Pesquisar...">
                <button id="searchBtn">üîç</button>
            </div>
            <a href="login.html" onclick="return logout()">Sair</a>
        </div>

        <!-- Conte√∫do principal -->
        <div class="main">
            <!-- Playlists do usu√°rio -->
            <div>
                <h3 class="section-title">Minhas Playlists</h3>
                <div id="userPlaylists" class="cards">
                    <!-- Playlists ser√£o adicionadas aqui -->
                </div>
            </div>

            <!-- M√∫sicas em alta -->
            <div>
                <h3 class="section-title">M√∫sicas em alta</h3>
                <div class="cards">
                    <div class="card" data-song="Entrelinhas" data-artist="Artista 1">
                        <img src="https://i.scdn.co/image/ab67616d0000b273f0700f96146e437349a6ea20" alt="Entrelinhas">
                        <h4>Entrelinhas</h4>
                        <button class="play-btn">‚ñ∂</button>
                    </div>
                    <div class="card" data-song="Piloto da Nasa" data-artist="Artista 2">
                        <img src="https://i.scdn.co/image/ab67616d00001e0220e020e6c6412855bc46b45c"
                            alt="Piloto da Nasa">
                        <h4>Piloto da Nasa</h4>
                        <button class="play-btn">‚ñ∂</button>
                    </div>
                    <div class="card" data-song="Artista Gen√©rico" data-artist="Artista 3">
                        <img src="https://m.media-amazon.com/images/I/41B1VbY-TwL._UXNaN_FMjpg_QL85_.jpg"
                            alt="Artista Gen√©rico">
                        <h4>Artista Gen√©rico</h4>
                        <button class="play-btn">‚ñ∂</button>
                    </div>
                </div>
            </div>

            <!-- Artistas populares -->
            <div>
                <h3 class="section-title">Artistas populares</h3>
                <div class="artists">
                    <div class="artist-card">
                        <img src="https://pbs.twimg.com/profile_images/1813452990302375936/li3KGu_F_400x400.jpg"
                            alt="Boaventura">
                        <h4>Boaventura</h4>
                        <button class="follow-btn">Seguir</button>
                    </div>
                    <div class="artist-card">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQvnNC5nB1Bs-1mEKNcE9SAJKmbi9CJvGbd1UrSvCpNtzMpfHiPbBPilxOWHmDFfrEMRkAwjWc8mB6FaH4_EG_YNVS9h2fPYA-mXktaYoQg"
                            alt="Veigh">
                        <h4>Veigh</h4>
                        <button class="follow-btn">Seguir</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== SISTEMA DE PLAYER DE M√öSICA COM SOUNDCLOUD =====
        let currentSongIndex = 0;
        let isPlaying = false;
        let currentPlaylist = [];
        let soundcloudWidget = null;

        // Elementos do player
        const audioPlayer = document.getElementById('audioPlayer');
        const musicPlayer = document.getElementById('musicPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const songProgress = document.getElementById('songProgress');
        const currentTimeDisplay = document.getElementById('currentTime');
        const totalTimeDisplay = document.getElementById('totalTime');
        const playerSongTitle = document.getElementById('playerSongTitle');
        const playerArtist = document.getElementById('playerArtist');
        const playerAlbumCover = document.getElementById('playerAlbumCover');

        // M√∫sicas com SoundCloud - TODAS COM LINKS REAIS
        const sampleSongs = [
            {
                title: "Entrelinhas",
                artist: "Boaventura",
                cover: "https://i.scdn.co/image/ab67616d0000b273f0700f96146e437349a6ea20",
                audio: "https://on.soundcloud.com/0McdDgMJEzPxQf0Hkq",
                soundcloudUrl: "https://soundcloud.com/dvdesg/boaventura-entrelinhas"
            },
            {
                title: "Piloto da Nasa",
                artist: "Mc Kevin, Vulgo FK, Gaab",
                cover: "https://i.scdn.co/image/ab67616d00001e0220e020e6c6412855bc46b45c",
                audio: "https://soundcloud.com/almirantedamassa/gaab-part-vulgo-fk-mc-kevin-piloto-da-nasa?si=1bceb6043a8346c096e1e6de31658c14&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing",
                soundcloudUrl: "https://soundcloud.com/almirantedamassa/gaab-part-vulgo-fk-mc-kevin-piloto-da-nasa?si=1bceb6043a8346c096e1e6de31658c14&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing"
            },
            {
                title: "Artista Gen√©rico",
                artist: "Veigh",
                cover: "https://m.media-amazon.com/images/I/41B1VbY-TwL._UXNaN_FMjpg_QL85_.jpg",
                audio: "https://soundcloud.com/gabrieumcpe/artista-generico-og-version?si=1fe294f68a9f47928d29cbdd8e149743&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing",
                soundcloudUrl: "https://soundcloud.com/gabrieumcpe/artista-generico-og-version?si=1fe294f68a9f47928d29cbdd8e149743&utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing"
            }
        ];

        // ===== FUN√á√ïES DO PLAYER SOUNDCLOUD =====
        function playSong(songIndex, playlist = sampleSongs) {
            currentPlaylist = playlist;
            currentSongIndex = songIndex;
            const song = currentPlaylist[currentSongIndex];

            // Atualiza interface
            playerSongTitle.textContent = song.title;
            playerArtist.textContent = song.artist;
            playerAlbumCover.src = song.cover;

            // Mostra o player
            musicPlayer.classList.add('player-visible');

            // Para √°udio normal se estiver tocando
            if (audioPlayer.src) {
                audioPlayer.pause();
                audioPlayer.src = '';
            }

            // Remove widget anterior se existir
            const existingWidget = document.getElementById('soundcloudWidget');
            if (existingWidget) {
                existingWidget.remove();
            }

            // Sempre usa SoundCloud para essas m√∫sicas
            playSoundCloudSong(song.soundcloudUrl || song.audio);
        }

        // Fun√ß√£o para carregar e tocar m√∫sica do SoundCloud
        function playSoundCloudSong(soundcloudUrl) {
            // Cria container para o widget
            const widgetContainer = document.createElement('div');
            widgetContainer.id = 'soundcloudWidget';
            widgetContainer.style.display = 'none'; // Escondemos o widget
            document.body.appendChild(widgetContainer);

            // Cria o iframe do SoundCloud
            const iframe = document.createElement('iframe');
            iframe.id = 'soundcloudIframe';
            iframe.width = '100%';
            iframe.height = '166';
            iframe.scrolling = 'no';
            iframe.frameBorder = 'no';
            iframe.allow = 'autoplay';

            // URL do widget SoundCloud
            const widgetUrl = `https://w.soundcloud.com/player/?url=${encodeURIComponent(soundcloudUrl)}&color=%231DB954&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=true&visual=false`;
            iframe.src = widgetUrl;

            widgetContainer.appendChild(iframe);

            // Configura o widget
            soundcloudWidget = iframe;

            isPlaying = true;
            playPauseBtn.textContent = '‚è∏';

            console.log('Reproduzindo SoundCloud:', soundcloudUrl);

            // Tenta controlar o widget via API
            setupSoundCloudWidget(iframe);
        }

        // Configura o widget do SoundCloud
        function setupSoundCloudWidget(iframe) {
            // A API do SoundCloud requer que o widget seja carregado
            iframe.onload = function () {
                console.log('Widget SoundCloud carregado');

                // Tenta acessar a API
                try {
                    const widget = SC.Widget(iframe);

                    widget.bind(SC.Widget.Events.READY, function () {
                        console.log('SoundCloud Widget pronto');
                    });

                    widget.bind(SC.Widget.Events.PLAY, function () {
                        console.log('SoundCloud: Tocando');
                        isPlaying = true;
                        playPauseBtn.textContent = '‚è∏';
                    });

                    widget.bind(SC.Widget.Events.PAUSE, function () {
                        console.log('SoundCloud: Pausado');
                        isPlaying = false;
                        playPauseBtn.textContent = '‚ñ∂';
                    });

                    widget.bind(SC.Widget.Events.FINISH, function () {
                        console.log('SoundCloud: M√∫sica terminou');
                        nextSong();
                    });

                } catch (error) {
                    console.log('API SoundCloud n√£o dispon√≠vel, usando controles b√°sicos');
                }
            };
        }

        function togglePlay() {
            if (!soundcloudWidget) return;

            try {
                const widget = SC.Widget(soundcloudWidget);

                widget.getPosition(function (position) {
                    widget.getDuration(function (duration) {
                        if (position === duration || position === 0) {
                            // Se a m√∫sica terminou ou n√£o come√ßou, recome√ßa
                            widget.play();
                            isPlaying = true;
                            playPauseBtn.textContent = '‚è∏';
                        } else {
                            // Pausa/Continua a reprodu√ß√£o
                            widget.toggle();
                        }
                    });
                });
            } catch (error) {
                console.log('Erro ao controlar SoundCloud:', error);
                // Fallback: recarrega a m√∫sica atual
                playSong(currentSongIndex, currentPlaylist);
            }
        }

        function nextSong() {
            if (currentPlaylist.length === 0) return;

            currentSongIndex = (currentSongIndex + 1) % currentPlaylist.length;
            playSong(currentSongIndex, currentPlaylist);
        }

        function previousSong() {
            if (currentPlaylist.length === 0) return;

            currentSongIndex = (currentSongIndex - 1 + currentPlaylist.length) % currentPlaylist.length;
            playSong(currentSongIndex, currentPlaylist);
        }

        function seekSong(event) {
            // Para SoundCloud, n√£o √© poss√≠vel controlar o seek via API facilmente
            alert('Controle de seek n√£o dispon√≠vel para SoundCloud');
        }

        function changeVolume(event) {
            const volumeBar = event.currentTarget;
            const clickPosition = event.offsetX;
            const totalWidth = volumeBar.offsetWidth;
            const volume = clickPosition / totalWidth;

            // Tenta controlar volume do SoundCloud
            if (soundcloudWidget) {
                try {
                    const widget = SC.Widget(soundcloudWidget);
                    widget.setVolume(volume * 100);
                } catch (error) {
                    console.log('N√£o foi poss√≠vel controlar volume do SoundCloud');
                }
            }

            document.getElementById('volumeLevel').style.width = (volume * 100) + '%';
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";

            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        // Atualiza tempo para SoundCloud (aproximado)
        function updateSoundCloudTime() {
            if (soundcloudWidget) {
                try {
                    const widget = SC.Widget(soundcloudWidget);
                    widget.getPosition(function (position) {
                        currentTimeDisplay.textContent = formatTime(position / 1000);
                    });
                    widget.getDuration(function (duration) {
                        totalTimeDisplay.textContent = formatTime(duration / 1000);
                    });
                } catch (error) {
                    // Ignora erros de tempo
                }
            }
        }

        // Atualiza o tempo a cada segundo
        setInterval(updateSoundCloudTime, 1000);

        // Atualiza progresso para √°udios normais
        audioPlayer.ontimeupdate = function () {
            if (!isNaN(audioPlayer.duration)) {
                const progressPercent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                songProgress.style.width = progressPercent + '%';
                currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
                totalTimeDisplay.textContent = formatTime(audioPlayer.duration);
            }
        };

        // ===== SISTEMA DE AUTENTICA√á√ÉO E PLAYlists =====
        function logout() {
            sessionStorage.removeItem('currentUser');
            window.location.href = "login.html?logout=true";
            return false;
        }

        // Carrega a API do SoundCloud
        function loadSoundCloudAPI() {
            const script = document.createElement('script');
            script.src = 'https://w.soundcloud.com/player/api.js';
            script.onload = function () {
                console.log('SoundCloud API carregada');
            };
            document.head.appendChild(script);
        }

        // Verificar autentica√ß√£o
        window.addEventListener('DOMContentLoaded', function () {
            const currentUser = sessionStorage.getItem('currentUser');

            if (!currentUser) {
                alert('Por favor, fa√ßa login para acessar esta p√°gina.');
                window.location.href = "login.html";
                return;
            }

            // Carrega API do SoundCloud
            loadSoundCloudAPI();

            loadPlaylists();
            setupEventListeners();
        });

        // Sistema de playlists
        function loadPlaylists() {
    const userPlaylists = document.getElementById('userPlaylists');
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    userPlaylists.innerHTML = '';
    
    playlists.forEach(playlist => {
        const playlistCard = document.createElement('div');
        playlistCard.className = 'card';
        playlistCard.innerHTML = `
            <img src="https://community.spotify.com/t5/image/serverpage/image-id/25294i2836BD1C1A31BDF2/image-size/original?v=mpbl-1&px=-1" alt="${playlist.name}">
            <h4>${playlist.name}</h4>
            <p>${playlist.songs ? playlist.songs.length : 0} m√∫sicas</p>
            <button class="play-btn" onclick="playPlaylist(${playlist.id})">‚ñ∂</button>
            <button class="view-playlist" onclick="viewPlaylist(${playlist.id})" style="
                position: absolute;
                bottom: 10px;
                left: 10px;
                background: #3498db;
                border: none;
                border-radius: 15px;
                padding: 5px 10px;
                color: white;
                cursor: pointer;
                font-size: 0.8rem;
                opacity: 0;
                transition: opacity 0.3s;
            ">Abrir</button>
            <button class="edit-playlist" onclick="editPlaylist(${playlist.id})">Editar</button>
            <button class="delete-playlist" onclick="deletePlaylist(${playlist.id})">Excluir</button>
        `;
        userPlaylists.appendChild(playlistCard);
    });
    
    // Adiciona estilo para mostrar bot√£o "Abrir" no hover
    if (!document.getElementById('playlistViewStyles')) {
        const style = document.createElement('style');
        style.id = 'playlistViewStyles';
        style.textContent = `
            .card:hover .view-playlist {
                opacity: 1 !important;
            }
        `;
        document.head.appendChild(style);
    }
}

// ===== FUN√á√ïES DE EDI√á√ÉO DE PLAYLIST =====
function editPlaylist(playlistId) {
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    const playlist = playlists.find(p => p.id === playlistId);
    
    if (!playlist) {
        alert('Playlist n√£o encontrada!');
        return;
    }
    
    // Modal de edi√ß√£o
    const modalHtml = `
        <div id="editPlaylistModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        ">
            <div style="
                background: #1c1c1c;
                padding: 30px;
                border-radius: 15px;
                width: 90%;
                max-width: 500px;
                border: 2px solid #1DB954;
            ">
                <h3 style="color: #1DB954; margin-bottom: 20px;">Editar Playlist</h3>
                
                <div style="margin-bottom: 20px;">
                    <label style="color: white; display: block; margin-bottom: 8px;">Nome da Playlist:</label>
                    <input type="text" id="editPlaylistName" value="${playlist.name}" style="
                        width: 100%;
                        padding: 10px;
                        border-radius: 8px;
                        border: 1px solid #333;
                        background: #121212;
                        color: white;
                        font-size: 1rem;
                    ">
                </div>
                
                <h4 style="color: #1DB954; margin: 20px 0 10px 0;">M√∫sicas na Playlist (${playlist.songs ? playlist.songs.length : 0})</h4>
                
                <div id="playlistSongsList" style="
                    max-height: 200px;
                    overflow-y: auto;
                    margin-bottom: 20px;
                    background: #121212;
                    padding: 10px;
                    border-radius: 8px;
                ">
                    ${playlist.songs && playlist.songs.length > 0 ? 
                        playlist.songs.map((song, index) => `
                            <div style="
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                padding: 8px;
                                border-bottom: 1px solid #333;
                            ">
                                <div>
                                    <strong style="color: white;">${song.title}</strong>
                                    <br>
                                    <span style="color: #bbb; font-size: 0.9rem;">${song.artist}</span>
                                </div>
                                <button onclick="removeSongFromPlaylist(${playlistId}, ${index})" style="
                                    background: #e74c3c;
                                    border: none;
                                    color: white;
                                    padding: 5px 10px;
                                    border-radius: 5px;
                                    cursor: pointer;
                                ">Remover</button>
                            </div>
                        `).join('') 
                        : '<p style="color: #bbb; text-align: center;">Nenhuma m√∫sica adicionada</p>'
                    }
                </div>
                
                <h4 style="color: #1DB954; margin: 20px 0 10px 0;">Adicionar M√∫sicas</h4>
                
                <div style="margin-bottom: 20px;">
                    <select id="addSongSelect" style="
                        width: 100%;
                        padding: 10px;
                        border-radius: 8px;
                        border: 1px solid #333;
                        background: #121212;
                        color: white;
                        margin-bottom: 10px;
                    ">
                        <option value="">Selecione uma m√∫sica para adicionar</option>
                        ${sampleSongs.map(song => `
                            <option value="${song.title}">${song.title} - ${song.artist}</option>
                        `).join('')}
                    </select>
                    <button onclick="addSongToPlaylist(${playlistId})" style="
                        background: #1DB954;
                        border: none;
                        color: white;
                        padding: 10px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        width: 100%;
                    ">Adicionar M√∫sica</button>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeEditModal()" style="
                        background: #666;
                        border: none;
                        color: white;
                        padding: 10px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                    ">Cancelar</button>
                    <button onclick="savePlaylistChanges(${playlistId})" style="
                        background: #1DB954;
                        border: none;
                        color: white;
                        padding: 10px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                    ">Salvar Altera√ß√µes</button>
                </div>
            </div>
        </div>
    `;
    
    // Adiciona o modal √† p√°gina
    document.body.insertAdjacentHTML('beforeend', modalHtml);
}

function closeEditModal() {
    const modal = document.getElementById('editPlaylistModal');
    if (modal) {
        modal.remove();
    }
}

function savePlaylistChanges(playlistId) {
    const newName = document.getElementById('editPlaylistName').value.trim();
    
    if (!newName) {
        alert('Digite um nome para a playlist!');
        return;
    }
    
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    const playlistIndex = playlists.findIndex(p => p.id === playlistId);
    
    if (playlistIndex !== -1) {
        playlists[playlistIndex].name = newName;
        localStorage.setItem('userPlaylists', JSON.stringify(playlists));
        
        // Recarrega as playlists
        loadPlaylists();
        
        // Atualiza resultados de pesquisa se estiverem vis√≠veis
        const searchInput = document.getElementById('searchInput');
        if (searchInput.value) {
            performSearch();
        }
        
        closeEditModal();
        alert('Playlist atualizada com sucesso!');
    }
}

function addSongToPlaylist(playlistId) {
    const songSelect = document.getElementById('addSongSelect');
    const selectedSongTitle = songSelect.value;
    
    if (!selectedSongTitle) {
        alert('Selecione uma m√∫sica para adicionar!');
        return;
    }
    
    const songToAdd = sampleSongs.find(song => song.title === selectedSongTitle);
    
    if (!songToAdd) {
        alert('M√∫sica n√£o encontrada!');
        return;
    }
    
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    const playlistIndex = playlists.findIndex(p => p.id === playlistId);
    
    if (playlistIndex !== -1) {
        // Inicializa array de songs se n√£o existir
        if (!playlists[playlistIndex].songs) {
            playlists[playlistIndex].songs = [];
        }
        
        // Verifica se a m√∫sica j√° est√° na playlist
        const songExists = playlists[playlistIndex].songs.some(song => song.title === songToAdd.title);
        
        if (songExists) {
            alert('Esta m√∫sica j√° est√° na playlist!');
            return;
        }
        
        // Adiciona a m√∫sica
        playlists[playlistIndex].songs.push({
            title: songToAdd.title,
            artist: songToAdd.artist,
            cover: songToAdd.cover,
            audio: songToAdd.audio,
            soundcloudUrl: songToAdd.soundcloudUrl
        });
        
        localStorage.setItem('userPlaylists', JSON.stringify(playlists));
        
        // Atualiza o modal
        closeEditModal();
        editPlaylist(playlistId); // Reabre o modal atualizado
        
        alert(`"${songToAdd.title}" adicionada √† playlist!`);
    }
}

function removeSongFromPlaylist(playlistId, songIndex) {
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    const playlistIndex = playlists.findIndex(p => p.id === playlistId);
    
    if (playlistIndex !== -1 && playlists[playlistIndex].songs) {
        const removedSong = playlists[playlistIndex].songs[songIndex];
        playlists[playlistIndex].songs.splice(songIndex, 1);
        
        localStorage.setItem('userPlaylists', JSON.stringify(playlists));
        
        // Atualiza o modal
        closeEditModal();
        editPlaylist(playlistId); // Reabre o modal atualizado
        
        alert(`"${removedSong.title}" removida da playlist!`);
    }
}

function deletePlaylist(playlistId) {
    if (confirm('Tem certeza que deseja excluir esta playlist? Esta a√ß√£o n√£o pode ser desfeita.')) {
        let playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
        const playlistIndex = playlists.findIndex(p => p.id === playlistId);
        
        if (playlistIndex !== -1) {
            const playlistName = playlists[playlistIndex].name;
            playlists.splice(playlistIndex, 1);
            localStorage.setItem('userPlaylists', JSON.stringify(playlists));
            
            loadPlaylists();
            
            // Atualiza resultados de pesquisa se estiverem vis√≠veis
            const searchInput = document.getElementById('searchInput');
            if (searchInput.value) {
                performSearch();
            }
            
            alert(`Playlist "${playlistName}" exclu√≠da com sucesso!`);
        }
    }
}

        function playPlaylist(playlistId) {
            const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
            const playlist = playlists.find(p => p.id === playlistId);

            if (playlist && playlist.songs && playlist.songs.length > 0) {
                playSong(0, playlist.songs);
            } else {
                alert('Playlist vazia! Adicione m√∫sicas primeiro.');
            }
        }

        function setupEventListeners() {
    // Criar playlist
    document.getElementById('criarPlaylistBtn').addEventListener('click', () => {
        const nomePlaylist = prompt('Digite o nome da nova playlist:');
        if(nomePlaylist) {
            let playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
            const newPlaylist = {
                id: Date.now(),
                name: nomePlaylist,
                songs: []
            };
            playlists.push(newPlaylist);
            localStorage.setItem('userPlaylists', JSON.stringify(playlists));
            loadPlaylists();
        }
    });

    // ===== SISTEMA DE PESQUISA REAL =====
    document.getElementById('searchBtn').addEventListener('click', performSearch);
    
    // Pesquisar ao pressionar Enter
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });

    function performSearch() {
        const query = document.getElementById('searchInput').value.toLowerCase().trim();
        
        if (!query) {
            alert('Digite algo para pesquisar!');
            return;
        }

        console.log('Pesquisando por:', query);
        
        // Resultados da pesquisa
        const searchResults = {
            musicas: [],
            playlists: [],
            artistas: []
        };

        // Pesquisar nas m√∫sicas
        sampleSongs.forEach(song => {
            if (song.title.toLowerCase().includes(query) || 
                song.artist.toLowerCase().includes(query)) {
                searchResults.musicas.push(song);
            }
        });

        // Pesquisar nas playlists do usu√°rio
        const userPlaylists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
        userPlaylists.forEach(playlist => {
            if (playlist.name.toLowerCase().includes(query)) {
                searchResults.playlists.push(playlist);
            }
        });

        // Pesquisar artistas (baseado nas m√∫sicas)
        const artistasEncontrados = [];
        sampleSongs.forEach(song => {
            if (song.artist.toLowerCase().includes(query) && 
                !artistasEncontrados.includes(song.artist)) {
                artistasEncontrados.push(song.artist);
            }
        });
        
        artistasEncontrados.forEach(artista => {
            searchResults.artistas.push({
                name: artista,
                image: sampleSongs.find(song => song.artist === artista)?.cover || 'https://community.spotify.com/t5/image/serverpage/image-id/25294i2836BD1C1A31BDF2/image-size/original?v=mpbl-1&px=-1'
            });
        });

        // Mostrar resultados
        showSearchResults(searchResults, query);
    }

    function showSearchResults(results, query) {
        // Cria ou atualiza a se√ß√£o de resultados
        let resultsSection = document.getElementById('searchResultsSection');
        
        if (!resultsSection) {
            resultsSection = document.createElement('div');
            resultsSection.id = 'searchResultsSection';
            resultsSection.innerHTML = '<h3 class="section-title">Resultados da Pesquisa</h3>';
            document.querySelector('.main').insertBefore(resultsSection, document.querySelector('.main').firstChild);
        }

        resultsSection.innerHTML = `
            <h3 class="section-title">Resultados para: "${query}"</h3>
            
            ${results.musicas.length > 0 ? `
            <div class="search-category">
                <h4>M√∫sicas</h4>
                <div class="cards">
                    ${results.musicas.map(song => `
                        <div class="card" data-song="${song.title}" data-artist="${song.artist}">
                            <img src="${song.cover}" alt="${song.title}">
                            <h4>${song.title}</h4>
                            <p>${song.artist}</p>
                            <button class="play-btn">‚ñ∂</button>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            ${results.playlists.length > 0 ? `
            <div class="search-category">
                <h4>Playlists</h4>
                <div class="cards">
                    ${results.playlists.map(playlist => `
                        <div class="card">
                            <img src="https://community.spotify.com/t5/image/serverpage/image-id/25294i2836BD1C1A31BDF2/image-size/original?v=mpbl-1&px=-1" alt="${playlist.name}">
                            <h4>${playlist.name}</h4>
                            <p>${playlist.songs ? playlist.songs.length : 0} m√∫sicas</p>
                            <button class="play-btn" onclick="playPlaylist(${playlist.id})">‚ñ∂</button>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            ${results.artistas.length > 0 ? `
            <div class="search-category">
                <h4>Artistas</h4>
                <div class="artists">
                    ${results.artistas.map(artist => `
                        <div class="artist-card">
                            <img src="${artist.image}" alt="${artist.name}">
                            <h4>${artist.name}</h4>
                            <button class="follow-btn">Seguir</button>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            ${results.musicas.length === 0 && results.playlists.length === 0 && results.artistas.length === 0 ? `
            <div class="no-results">
                <p>Nenhum resultado encontrado para "${query}"</p>
                <p>Tente outros termos de pesquisa.</p>
            </div>
            ` : ''}
        `;

        // Adiciona estilo para os resultados
        if (!document.getElementById('searchStyles')) {
            const style = document.createElement('style');
            style.id = 'searchStyles';
            style.textContent = `
                .search-category {
                    margin: 20px 0;
                }
                
                .search-category h4 {
                    color: #1DB954;
                    margin-bottom: 10px;
                    font-size: 1.2rem;
                }
                
                .no-results {
                    text-align: center;
                    padding: 40px;
                    color: #bbb;
                }
                
                .no-results p {
                    margin: 10px 0;
                }
            `;
            document.head.appendChild(style);
        }
    }

    // Limpar pesquisa quando o input for alterado para vazio
    document.getElementById('searchInput').addEventListener('input', function() {
        if (this.value.trim() === '') {
            const resultsSection = document.getElementById('searchResultsSection');
            if (resultsSection) {
                resultsSection.remove();
            }
        }
    });

    // Bot√µes de play nas m√∫sicas (agora funciona nos resultados tamb√©m)
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('play-btn')) {
            const card = e.target.closest('.card');
            const songTitle = card.querySelector('h4').textContent;
            const artist = card.getAttribute('data-artist') || card.querySelector('p')?.textContent || 'Artista Desconhecido';
            
            // Encontra a m√∫sica na lista
            const songIndex = sampleSongs.findIndex(song => 
                song.title === songTitle || (song.artist === artist && song.title === songTitle)
            );
            
            if (songIndex !== -1) {
                playSong(songIndex, sampleSongs);
            } else {
                // Se n√£o encontrou, tenta pelo t√≠tulo
                const songByTitle = sampleSongs.find(song => song.title === songTitle);
                if (songByTitle) {
                    playSong(sampleSongs.indexOf(songByTitle), sampleSongs);
                } else {
                    alert('M√∫sica n√£o encontrada na biblioteca!');
                }
            }
        }

        if (e.target.classList.contains('follow-btn')) {
            const artistCard = e.target.closest('.artist-card');
            const artistName = artistCard.querySelector('h4').textContent;
            e.target.textContent = e.target.textContent === 'Seguir' ? 'Seguindo' : 'Seguir';
            alert(`Voc√™ ${e.target.textContent === 'Seguindo' ? 'seguiu' : 'deixou de seguir'} ${artistName}`);
        }

        if (e.target.classList.contains('delete-playlist')) {
            const playlistId = parseInt(e.target.getAttribute('data-id'));
            if (confirm('Tem certeza que deseja excluir esta playlist?')) {
                let playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
                playlists = playlists.filter(p => p.id !== playlistId);
                localStorage.setItem('userPlaylists', JSON.stringify(playlists));
                loadPlaylists();
                
                // Atualiza resultados de pesquisa se estiverem vis√≠veis
                const searchInput = document.getElementById('searchInput');
                if (searchInput.value) {
                    performSearch();
                }
            }
        }
    });

    // Explorar podcasts
    document.getElementById('explorePodcastsBtn').addEventListener('click', function() {
        alert('Funcionalidade de explorar podcasts em desenvolvimento!');
    });
}
// ===== SISTEMA DE VISUALIZA√á√ÉO DE PLAYLIST =====
function viewPlaylist(playlistId) {
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    const playlist = playlists.find(p => p.id === playlistId);
    
    if (!playlist) {
        alert('Playlist n√£o encontrada!');
        return;
    }
    
    // Modal de visualiza√ß√£o da playlist
    const modalHtml = `
        <div id="viewPlaylistModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            overflow-y: auto;
        ">
            <div style="
                background: #1c1c1c;
                padding: 30px;
                border-radius: 15px;
                width: 90%;
                max-width: 800px;
                max-height: 90vh;
                overflow-y: auto;
                border: 2px solid #1DB954;
            ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #1DB954; margin: 0;">${playlist.name}</h3>
                    <button onclick="closeViewModal()" style="
                        background: #666;
                        border: none;
                        color: white;
                        padding: 8px 15px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 1.2rem;
                    ">√ó</button>
                </div>
                
                <div style="display: flex; gap: 20px; margin-bottom: 20px; align-items: center;">
                    <img src="https://community.spotify.com/t5/image/serverpage/image-id/25294i2836BD1C1A31BDF2/image-size/original?v=mpbl-1&px=-1" 
                         alt="${playlist.name}" 
                         style="width: 150px; height: 150px; border-radius: 10px; object-fit: cover;">
                    <div>
                        <p style="color: #bbb; margin: 5px 0;">PLAYLIST</p>
                        <h2 style="color: white; margin: 10px 0; font-size: 2rem;">${playlist.name}</h2>
                        <p style="color: #bbb;">${playlist.songs ? playlist.songs.length : 0} m√∫sicas</p>
                        <button onclick="playPlaylist(${playlistId})" style="
                            background: #1DB954;
                            border: none;
                            color: white;
                            padding: 12px 30px;
                            border-radius: 25px;
                            cursor: pointer;
                            font-size: 1rem;
                            font-weight: bold;
                            margin-top: 10px;
                        ">‚ñ∂ Reproduzir Playlist</button>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4 style="color: #1DB954; margin-bottom: 15px;">M√∫sicas da Playlist</h4>
                    
                    <div id="playlistSongsView">
                        ${playlist.songs && playlist.songs.length > 0 ? 
                            playlist.songs.map((song, index) => `
                                <div class="playlist-song-item" style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 12px;
                                    border-radius: 8px;
                                    margin-bottom: 8px;
                                    background: rgba(255,255,255,0.05);
                                    transition: background 0.3s;
                                    cursor: pointer;
                                " onmouseover="this.style.background='rgba(255,255,255,0.1)'" 
                                onmouseout="this.style.background='rgba(255,255,255,0.05)'"
                                onclick="playSongFromPlaylist(${playlistId}, ${index})">
                                    <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                                        <span style="color: #bbb; width: 30px; text-align: center;">${index + 1}</span>
                                        <img src="${song.cover}" alt="${song.title}" 
                                             style="width: 50px; height: 50px; border-radius: 5px; object-fit: cover;">
                                        <div>
                                            <div style="color: white; font-weight: bold;">${song.title}</div>
                                            <div style="color: #bbb; font-size: 0.9rem;">${song.artist}</div>
                                        </div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="color: #bbb; font-size: 0.9rem;">3:45</span>
                                        <button class="play-song-btn" style="
                                            background: transparent;
                                            border: none;
                                            color: #1DB954;
                                            font-size: 1.2rem;
                                            cursor: pointer;
                                            opacity: 0;
                                            transition: opacity 0.3s;
                                        ">‚ñ∂</button>
                                    </div>
                                </div>
                            `).join('') 
                            : `
                            <div style="text-align: center; padding: 40px; color: #bbb;">
                                <p>Esta playlist est√° vazia</p>
                                <button onclick="closeViewModal(); editPlaylist(${playlistId})" style="
                                    background: #1DB954;
                                    border: none;
                                    color: white;
                                    padding: 10px 20px;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    margin-top: 10px;
                                ">Adicionar M√∫sicas</button>
                            </div>
                            `
                        }
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button onclick="closeViewModal(); editPlaylist(${playlistId})" style="
                        background: #1DB954;
                        border: none;
                        color: white;
                        padding: 10px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                    ">Editar Playlist</button>
                </div>
            </div>
        </div>
    `;
    
    // Adiciona o modal √† p√°gina
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Adiciona estilos para os bot√µes de play
    const style = document.createElement('style');
    style.textContent = `
        .playlist-song-item:hover .play-song-btn {
            opacity: 1 !important;
        }
    `;
    document.head.appendChild(style);
}

function closeViewModal() {
    const modal = document.getElementById('viewPlaylistModal');
    if (modal) {
        modal.remove();
    }
}

function playSongFromPlaylist(playlistId, songIndex) {
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    const playlist = playlists.find(p => p.id === playlistId);
    
    if (playlist && playlist.songs && playlist.songs[songIndex]) {
        const song = playlist.songs[songIndex];
        
        // Toca a m√∫sica individual
        const tempSong = [{
            title: song.title,
            artist: song.artist,
            cover: song.cover,
            audio: song.audio,
            soundcloudUrl: song.soundcloudUrl
        }];
        
        playSong(0, tempSong);
        closeViewModal();
    }
}

// Atualize a fun√ß√£o playPlaylist para fechar o modal se estiver aberto
function playPlaylist(playlistId) {
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    const playlist = playlists.find(p => p.id === playlistId);
    
    if (playlist && playlist.songs && playlist.songs.length > 0) {
        playSong(0, playlist.songs);
        closeViewModal(); // Fecha o modal se estiver aberto
    } else {
        alert('Playlist vazia! Adicione m√∫sicas primeiro.');
    }
}
    </  >
</body>

</html>
