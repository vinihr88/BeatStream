<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Minha Biblioteca</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .search-container {
            display: flex;
            margin: 15px 0;
        }

        .search-container input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px 0 0 4px;
            background: #333;
            color: white;
        }

        .search-container button {
            padding: 8px 12px;
            background: #1DB954;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            color: white;
        }

        .card {
            position: relative;
        }

        .play-btn,
        .follow-btn,
        .edit-playlist,
        .delete-playlist {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: #1DB954;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: white;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover .play-btn,
        .card:hover .follow-btn,
        .card:hover .edit-playlist,
        .card:hover .delete-playlist {
            opacity: 1;
        }

        .edit-playlist,
        .delete-playlist {
            border-radius: 15px;
            width: auto;
            padding: 0 10px;
            font-size: 0.8rem;
        }

        .delete-playlist {
            background: #e74c3c;
            bottom: 50px;
        }
    </style>
</head>
<!-- Player de M√∫sica -->
<div id="musicPlayer" class="music-player">
    <div class="player-info">
        <img id="playerAlbumCover" src="" alt="Album Cover" class="player-album-cover">
        <div class="player-details">
            <h4 id="playerSongTitle">M√∫sica</h4>
            <p id="playerArtist">Artista</p>
        </div>
    </div>

    <div class="player-controls">
        <button class="control-btn" onclick="previousSong()">‚èÆ</button>
        <button class="control-btn" onclick="togglePlay()" id="playPauseBtn">‚ñ∂</button>
        <button class="control-btn" onclick="nextSong()">‚è≠</button>
    </div>

    <div class="progress-container">
        <span class="time-display" id="currentTime">0:00</span>
        <div class="progress-bar" onclick="seekSong(event)">
            <div class="progress" id="songProgress"></div>
        </div>
        <span class="time-display" id="totalTime">0:00</span>
    </div>

    <div class="volume-control">
        <span>üîä</span>
        <div class="volume-bar" onclick="changeVolume(event)">
            <div class="volume-level" id="volumeLevel"></div>
        </div>
    </div>
</div>

<!-- √Åudio invis√≠vel -->
<audio id="audioPlayer" preload="metadata"></audio>

<body>
    <div class="home-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Minha Biblioteca</h2>
            <button id="criarPlaylistBtn">Criar playlist</button>
            <button id="explorePodcastsBtn">Explore podcasts</button>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Pesquisar...">
                <button id="searchBtn">üîç</button>
            </div>
            <a href="login.html" onclick="return logout()">Sair</a>
        </div>

        <!-- Conte√∫do principal -->
        <div class="main">
            <!-- Sistema de API de M√∫sicas -->
<div id="loading" style="display: none; text-align: center; padding: 20px; color: #1DB954;">
    <div style="border: 4px solid #333; border-left: 4px solid #1DB954; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
    <p>üéµ Buscando m√∫sicas...</p>
</div>

<div id="searchResultsSection" style="display: none;">
    <!-- Resultados da API aparecer√£o aqui -->
</div>

<div id="mainContent">
    <!-- SEU CONTE√öDO ATUAL CONTINUA AQUI DENTRO -->
            <!-- Playlists do usu√°rio -->
            <div>
                <h3 class="section-title">Minhas Playlists</h3>
                <div id="userPlaylists" class="cards">
                    <!-- Playlists ser√£o adicionadas aqui -->
                </div>
            </div>

            <!-- M√∫sicas em alta -->
            <div>
                <h3 class="section-title">M√∫sicas em alta</h3>
                <div class="cards">
                    <div class="card" data-song="Entrelinhas" data-artist="Artista 1">
                        <img src="https://i.scdn.co/image/ab67616d0000b273f0700f96146e437349a6ea20" alt="Entrelinhas">
                        <h4>Entrelinhas</h4>
                        <button class="play-btn">‚ñ∂</button>
                    </div>
                    <div class="card" data-song="Piloto da Nasa" data-artist="Artista 2">
                        <img src="https://i.scdn.co/image/ab67616d00001e0220e020e6c6412855bc46b45c"
                            alt="Piloto da Nasa">
                        <h4>Piloto da Nasa</h4>
                        <button class="play-btn">‚ñ∂</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        
// ===== CONFIGURA√á√ÉO DO RAPIDAPI =====
const RAPID_API_KEY = "f413ecdd94msh79bffab8fb1253cp1e669ajs2533082c3a2f";
const RAPID_API_HOST = "musicapi13.p.rapidapi.com";

// Player
let currentSongIndex = 0;
let isPlaying = false;
let currentPlaylist = [];
let currentAudio = null;

const playPauseBtn = document.getElementById('playPauseBtn');
const songProgress = document.getElementById('songProgress');
const currentTimeDisplay = document.getElementById('currentTime');
const totalTimeDisplay = document.getElementById('totalTime');
const playerSongTitle = document.getElementById('playerSongTitle');
const playerArtist = document.getElementById('playerArtist');
const playerAlbumCover = document.getElementById('playerAlbumCover');
const audioPlayer = document.getElementById('audioPlayer');

// Fun√ß√£o principal de pesquisa usando RapidAPI
async function performSearch() {
    const query = document.getElementById('searchInput').value.trim();
    
    if (!query) {
        alert('Digite o nome de uma m√∫sica para pesquisar!');
        return;
    }

    document.getElementById('mainContent').style.display = 'none';
    document.getElementById('loading').style.display = 'block';
    
    try {
        const results = await searchMusicAPI(query);
        showSearchResults(results, query);
    } catch (error) {
        console.error('Erro na pesquisa:', error);
    } finally {
        document.getElementById('loading').style.display = 'none';
    }
}

// Chamada √† API do RapidAPI
async function searchMusicAPI(query) {
    const url = `https://${RAPID_API_HOST}/public/search/introspection?q=${encodeURIComponent(query)}`;
    const options = {
        method: 'GET',
        headers: {
            'x-rapidapi-key': RAPID_API_KEY,
            'x-rapidapi-host': RAPID_API_HOST
        }
    };

    const response = await fetch(url, options);
    if (!response.ok) throw new Error("Erro na API MusicAPI");

    return await response.json();
}

// Exibir resultados
function showSearchResults(data, query) {
    const resultsSection = document.getElementById('searchResultsSection');
    const tracks = data?.tracks || [];

    if (!tracks || tracks.length === 0) {
        resultsSection.innerHTML = `<h3>Nenhum resultado para "${query}"</h3>`;
        resultsSection.style.display = 'block';
        return;
    }

    resultsSection.innerHTML = `
        <h3>üéµ Resultados para: "${query}"</h3>
        <div class="cards">
            ${tracks.map(track => `
                <div class="card">
                    <img src="${track.image}" alt="${track.title}">
                    <h4>${track.title}</h4>
                    <p>${track.artist}</p>
                    ${track.preview ? 
                        `<button class="play-btn" onclick="playTrack('${track.preview}', '${track.title}', '${track.artist}', '${track.image}')">‚ñ∂</button>` 
                        : `<button class="play-btn" style="background:#666;">üîí</button>`}
                </div>
            `).join("")}
        </div>
    `;

    resultsSection.style.display = 'block';
}

// Player
function playTrack(previewUrl, title, artist, cover) {
    if (audioPlayer.src) {
        audioPlayer.pause();
        audioPlayer.src = '';
    }

    playerSongTitle.textContent = title;
    playerArtist.textContent = artist;
    playerAlbumCover.src = cover;

    audioPlayer.src = previewUrl;
    audioPlayer.play()
        .then(() => {
            isPlaying = true;
            playPauseBtn.textContent = '‚è∏';
        })
        .catch(error => console.error('Erro ao reproduzir:', error));
}

function togglePlay() {
    if (!audioPlayer.src) return;
    if (isPlaying) {
        audioPlayer.pause();
        isPlaying = false;
        playPauseBtn.textContent = '‚ñ∂';
    } else {
        audioPlayer.play();
        isPlaying = true;
        playPauseBtn.textContent = '‚è∏';
    }
}

audioPlayer.ontimeupdate = function() {
    if (!isNaN(audioPlayer.duration)) {
        const progressPercent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        songProgress.style.width = progressPercent + '%';
        currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
        totalTimeDisplay.textContent = formatTime(audioPlayer.duration);
    }
};

function formatTime(seconds) {
    if (isNaN(seconds)) return "0:00";
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${minutes}:${secs.toString().padStart(2,'0')}`;
}

document.getElementById('searchBtn').addEventListener('click', performSearch);
document.getElementById('searchInput').addEventListener('keypress', function(e){
    if(e.key === 'Enter') performSearch();
});

    </script>
</body>
</html>
