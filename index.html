<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Minha Biblioteca</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .search-container {
            display: flex;
            margin: 15px 0;
        }

        .search-container input {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px 0 0 4px;
            background: #333;
            color: white;
        }

        .search-container button {
            padding: 8px 12px;
            background: #1DB954;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            color: white;
        }

        .card {
            position: relative;
        }

        .play-btn,
        .follow-btn,
        .edit-playlist,
        .delete-playlist {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: #1DB954;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: white;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover .play-btn,
        .card:hover .follow-btn,
        .card:hover .edit-playlist,
        .card:hover .delete-playlist {
            opacity: 1;
        }

        .edit-playlist,
        .delete-playlist {
            border-radius: 15px;
            width: auto;
            padding: 0 10px;
            font-size: 0.8rem;
        }

        .delete-playlist {
            background: #e74c3c;
            bottom: 50px;
        }
    </style>
</head>
<!-- Player de M√∫sica -->
<div id="musicPlayer" class="music-player">
    <div class="player-info">
        <img id="playerAlbumCover" src="" alt="Album Cover" class="player-album-cover">
        <div class="player-details">
            <h4 id="playerSongTitle">M√∫sica</h4>
            <p id="playerArtist">Artista</p>
        </div>
    </div>

    <div class="player-controls">
        <button class="control-btn" onclick="previousSong()">‚èÆ</button>
        <button class="control-btn" onclick="togglePlay()" id="playPauseBtn">‚ñ∂</button>
        <button class="control-btn" onclick="nextSong()">‚è≠</button>
    </div>

    <div class="progress-container">
        <span class="time-display" id="currentTime">0:00</span>
        <div class="progress-bar" onclick="seekSong(event)">
            <div class="progress" id="songProgress"></div>
        </div>
        <span class="time-display" id="totalTime">0:00</span>
    </div>

    <div class="volume-control">
        <span>üîä</span>
        <div class="volume-bar" onclick="changeVolume(event)">
            <div class="volume-level" id="volumeLevel"></div>
        </div>
    </div>
</div>

<!-- √Åudio invis√≠vel -->
<audio id="audioPlayer" preload="metadata"></audio>

<body>
    <div class="home-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Minha Biblioteca</h2>
            <button id="criarPlaylistBtn">Criar playlist</button>
            <button id="explorePodcastsBtn">Explore podcasts</button>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Pesquisar...">
                <button id="searchBtn">üîç</button>
            </div>
            <a href="login.html" onclick="return logout()">Sair</a>
        </div>

        <!-- Conte√∫do principal -->
        <div class="main">
            <!-- Sistema de API de M√∫sicas -->
<div id="loading" style="display: none; text-align: center; padding: 20px; color: #1DB954;">
    <div style="border: 4px solid #333; border-left: 4px solid #1DB954; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
    <p>üéµ Buscando m√∫sicas...</p>
</div>

<div id="searchResultsSection" style="display: none;">
    <!-- Resultados da API aparecer√£o aqui -->
</div>

<div id="mainContent">
    <!-- SEU CONTE√öDO ATUAL CONTINUA AQUI DENTRO -->
            <!-- Playlists do usu√°rio -->
            <div>
                <h3 class="section-title">Minhas Playlists</h3>
                <div id="userPlaylists" class="cards">
                    <!-- Playlists ser√£o adicionadas aqui -->
                </div>
            </div>

            <!-- M√∫sicas em alta -->
            <div>
                <h3 class="section-title">M√∫sicas em alta</h3>
                <div class="cards">
                    <div class="card" data-song="Entrelinhas" data-artist="Artista 1">
                        <img src="https://i.scdn.co/image/ab67616d0000b273f0700f96146e437349a6ea20" alt="Entrelinhas">
                        <h4>Entrelinhas</h4>
                        <button class="play-btn">‚ñ∂</button>
                    </div>
                    <div class="card" data-song="Piloto da Nasa" data-artist="Artista 2">
                        <img src="https://i.scdn.co/image/ab67616d00001e0220e020e6c6412855bc46b45c"
                            alt="Piloto da Nasa">
                        <h4>Piloto da Nasa</h4>
                        <button class="play-btn">‚ñ∂</button>
                    </div>
                    <div class="card" data-song="Artista Gen√©rico" data-artist="Artista 3">
                        <img src="https://m.media-amazon.com/images/I/41B1VbY-TwL._UXNaN_FMjpg_QL85_.jpg"
                            alt="Artista Gen√©rico">
                        <h4>Artista Gen√©rico</h4>
                        <button class="play-btn">‚ñ∂</button>
                    </div>
                </div>
            </div>

            <!-- Artistas populares -->
            <div>
                <h3 class="section-title">Artistas populares</h3>
                <div class="artists">
                    <div class="artist-card">
                        <img src="https://pbs.twimg.com/profile_images/1813452990302375936/li3KGu_F_400x400.jpg"
                            alt="Boaventura">
                        <h4>Boaventura</h4>
                        <button class="follow-btn">Seguir</button>
                    </div>
                    <div class="artist-card">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQvnNC5nB1Bs-1mEKNcE9SAJKmbi9CJvGbd1UrSvCpNtzMpfHiPbBPilxOWHmDFfrEMRkAwjWc8mB6FaH4_EG_YNVS9h2fPYA-mXktaYoQg"
                            alt="Veigh">
                        <h4>Veigh</h4>
                        <button class="follow-btn">Seguir</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        
      // ===== SISTEMA DE PLAYER COM API DEEZER =====
let currentSongIndex = 0;
let isPlaying = false;
let currentPlaylist = [];
let currentAudio = null;

// Elementos do player
const musicPlayer = document.getElementById('musicPlayer');
const playPauseBtn = document.getElementById('playPauseBtn');
const songProgress = document.getElementById('songProgress');
const currentTimeDisplay = document.getElementById('currentTime');
const totalTimeDisplay = document.getElementById('totalTime');
const playerSongTitle = document.getElementById('playerSongTitle');
const playerArtist = document.getElementById('playerArtist');
const playerAlbumCover = document.getElementById('playerAlbumCover');
const audioPlayer = document.getElementById('audioPlayer');

// M√∫sicas da biblioteca local
const sampleSongs = [
    {
        title: "Entrelinhas",
        artist: "Boaventura",
        cover: "https://i.scdn.co/image/ab67616d0000b273f0700f96146e437349a6ea20",
        preview: "https://cdns-preview.d.dzcdn.net/stream/c-deda7fa9316d9e9e880d2c6207e92260-5.mp3"
    },
    {
        title: "Piloto da Nasa",
        artist: "Mc Kevin, Vulgo FK, Gaab", 
        cover: "https://i.scdn.co/image/ab67616d00001e0220e020e6c6412855bc46b45c",
        preview: "https://cdns-preview.d.dzcdn.net/stream/c-deda7fa9316d9e9e880d2c6207e92260-5.mp3"
    }
];

// ===== API DEEZER =====
const DEEZER_API = {
    searchUrl: 'https://api.deezer.com/search',
    trackUrl: 'https://api.deezer.com/track/'
};

// Fun√ß√£o principal de pesquisa
async function performSearch() {
    const query = document.getElementById('searchInput').value.trim();
    
    if (!query) {
        alert('Digite o nome de uma m√∫sica para pesquisar!');
        return;
    }

    console.log('üîç Pesquisando na Deezer:', query);
    
    // Mostra loading
    document.getElementById('mainContent').style.display = 'none';
    document.getElementById('loading').style.display = 'block';
    
    try {
        const results = await searchDeezer(query);
        showSearchResults(results, query);
    } catch (error) {
        console.error('Erro na pesquisa:', error);
        showErrorResults(query);
    } finally {
        document.getElementById('loading').style.display = 'none';
    }
}

// Pesquisa na API Deezer
async function searchDeezer(query) {
    const response = await fetch(`${DEEZER_API.searchUrl}?q=${encodeURIComponent(query)}&limit=20`);
    
    if (!response.ok) {
        throw new Error('Erro na API Deezer');
    }
    
    const data = await response.json();
    return data.data;
}

// Exibe resultados da pesquisa
function showSearchResults(tracks, query) {
    const resultsSection = document.getElementById('searchResultsSection');
    
    if (!tracks || tracks.length === 0) {
        resultsSection.innerHTML = `
            <div class="search-results-header">
                <h3 class="section-title">Resultados para: "${query}"</h3>
                <button class="back-button" onclick="showMainContent()">‚Üê Voltar</button>
            </div>
            <div class="no-results">
                <p>Nenhuma m√∫sica encontrada para "${query}"</p>
                <p>Tente outros termos de pesquisa.</p>
            </div>
        `;
        resultsSection.style.display = 'block';
        return;
    }

    resultsSection.innerHTML = `
        <div class="search-results-header">
            <h3 class="section-title">üéµ ${tracks.length} resultados para: "${query}"</h3>
            <button class="back-button" onclick="showMainContent()">‚Üê Voltar</button>
        </div>
        
        <div class="search-category">
            <h4>M√∫sicas</h4>
            <div class="cards">
                ${tracks.map(track => `
                    <div class="card" data-id="${track.id}">
                        <img src="${track.album.cover_medium}" alt="${track.title}" 
                             onerror="this.src='https://community.spotify.com/t5/image/serverpage/image-id/25294i2836BD1C1A31BDF2/image-size/original?v=mpbl-1&px=-1'">
                        <h4>${track.title_short || track.title}</h4>
                        <p>${track.artist.name}</p>
                        <p class="album-info">${track.album.title}</p>
                        <small style="color: #1DB954; position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); padding: 2px 5px; border-radius: 3px; font-size: 0.7rem;">
                            ${track.duration ? Math.floor(track.duration / 60) + ':' + (track.duration % 60).toString().padStart(2, '0') : '--:--'}
                        </small>
                        ${track.preview ? 
                            `<button class="play-btn" onclick="playDeezerTrack('${track.preview}', '${track.title_short || track.title}', '${track.artist.name}', '${track.album.cover_medium}')">‚ñ∂</button>` :
                            `<button class="play-btn" style="background: #666;" onclick="showNoPreviewMessage('${track.title_short || track.title}')">üîí</button>`
                        }
                    </div>
                `).join('')}
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px; color: #bbb;">
            <p>üéß Powered by Deezer API - Preview de 30 segundos</p>
        </div>
    `;
    
    resultsSection.style.display = 'block';
}

// Fun√ß√£o para mostrar erro
function showErrorResults(query) {
    const resultsSection = document.getElementById('searchResultsSection');
    
    resultsSection.innerHTML = `
        <div class="search-results-header">
            <h3 class="section-title">Resultados para: "${query}"</h3>
            <button class="back-button" onclick="showMainContent()">‚Üê Voltar</button>
        </div>
        <div class="no-results">
            <p>Erro ao buscar m√∫sicas. Verifique sua conex√£o.</p>
            <button onclick="performSearch()" style="
                background: #1DB954;
                border: none;
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                margin-top: 10px;
            ">Tentar Novamente</button>
        </div>
    `;
    
    resultsSection.style.display = 'block';
}

// ===== PLAYER DEEZER =====
function playDeezerTrack(previewUrl, title, artist, cover) {
    console.log('üéµ Tocando:', title, 'Artista:', artist);
    
    // Para √°udio anterior
    if (audioPlayer.src) {
        audioPlayer.pause();
        audioPlayer.src = '';
    }
    
    // Atualiza interface do player
    playerSongTitle.textContent = title;
    playerArtist.textContent = artist;
    playerAlbumCover.src = cover;
    musicPlayer.style.display = 'flex';
    musicPlayer.classList.add('player-visible');
    
    // Configura e toca o √°udio
    audioPlayer.src = previewUrl;
    audioPlayer.play()
        .then(() => {
            isPlaying = true;
            playPauseBtn.textContent = '‚è∏';
            showNotification(`üéµ Tocando: ${title} - ${artist}`);
        })
        .catch(error => {
            console.error('Erro ao reproduzir:', error);
            showNotification('‚ùå Erro ao reproduzir a m√∫sica');
        });
}

// Mensagem para m√∫sicas sem preview
function showNoPreviewMessage(title) {
    showNotification(`üîí "${title}" - Preview n√£o dispon√≠vel`);
}

// Controles do player
function togglePlay() {
    if (!audioPlayer.src) return;
    
    if (isPlaying) {
        audioPlayer.pause();
        isPlaying = false;
        playPauseBtn.textContent = '‚ñ∂';
    } else {
        audioPlayer.play()
            .then(() => {
                isPlaying = true;
                playPauseBtn.textContent = '‚è∏';
            })
            .catch(error => {
                console.error('Erro ao retomar:', error);
            });
    }
}

function nextSong() {
    // Para demonstra√ß√£o, toca pr√≥xima m√∫sica da biblioteca
    currentSongIndex = (currentSongIndex + 1) % sampleSongs.length;
    const song = sampleSongs[currentSongIndex];
    playDeezerTrack(song.preview, song.title, song.artist, song.cover);
}

function previousSong() {
    currentSongIndex = (currentSongIndex - 1 + sampleSongs.length) % sampleSongs.length;
    const song = sampleSongs[currentSongIndex];
    playDeezerTrack(song.preview, song.title, song.artist, song.cover);
}

function seekSong(event) {
    if (!audioPlayer.src || isNaN(audioPlayer.duration)) return;
    
    const progressBar = event.currentTarget;
    const clickPosition = event.offsetX;
    const totalWidth = progressBar.offsetWidth;
    const seekTime = (clickPosition / totalWidth) * audioPlayer.duration;
    
    audioPlayer.currentTime = seekTime;
}

function changeVolume(event) {
    const volumeBar = event.currentTarget;
    const clickPosition = event.offsetX;
    const totalWidth = volumeBar.offsetWidth;
    const volume = clickPosition / totalWidth;
    
    audioPlayer.volume = volume;
    document.getElementById('volumeLevel').style.width = (volume * 100) + '%';
}

// Atualiza progresso da m√∫sica
audioPlayer.ontimeupdate = function() {
    if (!isNaN(audioPlayer.duration)) {
        const progressPercent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        songProgress.style.width = progressPercent + '%';
        currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
        totalTimeDisplay.textContent = formatTime(audioPlayer.duration);
    }
};

audioPlayer.onended = function() {
    isPlaying = false;
    playPauseBtn.textContent = '‚ñ∂';
    showNotification('‚èπ M√∫sica terminada');
};

// Formata tempo (mm:ss)
function formatTime(seconds) {
    if (isNaN(seconds)) return "0:00";
    
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${minutes}:${secs.toString().padStart(2, '0')}`;
}

// ===== FUN√á√ïES AUXILIARES =====
function showMainContent() {
    document.getElementById('searchResultsSection').style.display = 'none';
    document.getElementById('mainContent').style.display = 'block';
    document.getElementById('searchInput').value = '';
}

function showNotification(message) {
    const existingNotification = document.getElementById('musicNotification');
    if (existingNotification) existingNotification.remove();

    const notification = document.createElement('div');
    notification.id = 'musicNotification';
    notification.innerHTML = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #1DB954;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 10000;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease;
    `;

    document.body.appendChild(notification);
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 3000);
}

// ===== SISTEMA DE PLAYLISTS =====
function loadPlaylists() {
    const userPlaylists = document.getElementById('userPlaylists');
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    userPlaylists.innerHTML = '';
    
    playlists.forEach(playlist => {
        const playlistCard = document.createElement('div');
        playlistCard.className = 'card';
        playlistCard.innerHTML = `
            <img src="https://community.spotify.com/t5/image/serverpage/image-id/25294i2836BD1C1A31BDF2/image-size/original?v=mpbl-1&px=-1" alt="${playlist.name}">
            <h4>${playlist.name}</h4>
            <p>${playlist.songs ? playlist.songs.length : 0} m√∫sicas</p>
            <button class="play-btn" onclick="playPlaylist(${playlist.id})">‚ñ∂</button>
        `;
        userPlaylists.appendChild(playlistCard);
    });
}

function playPlaylist(playlistId) {
    const playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
    const playlist = playlists.find(p => p.id === playlistId);
    if (playlist && playlist.songs && playlist.songs.length > 0) {
        const firstSong = playlist.songs[0];
        playDeezerTrack(firstSong.preview, firstSong.title, firstSong.artist, firstSong.cover);
    } else {
        alert('Playlist vazia! Adicione m√∫sicas primeiro.');
    }
}

// ===== CONFIGURA√á√ÉO INICIAL =====
function setupEventListeners() {
    // Criar playlist
    document.getElementById('criarPlaylistBtn').addEventListener('click', () => {
        const nomePlaylist = prompt('Digite o nome da nova playlist:');
        if (nomePlaylist) {
            let playlists = JSON.parse(localStorage.getItem('userPlaylists')) || [];
            const newPlaylist = {
                id: Date.now(),
                name: nomePlaylist,
                songs: []
            };
            playlists.push(newPlaylist);
            localStorage.setItem('userPlaylists', JSON.stringify(playlists));
            loadPlaylists();
        }
    });

    // Pesquisar
    document.getElementById('searchBtn').addEventListener('click', performSearch);
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') performSearch();
    });

    // Limpar pesquisa
    document.getElementById('searchInput').addEventListener('input', function() {
        if (this.value.trim() === '') {
            showMainContent();
        }
    });

    // Bot√µes de play nas m√∫sicas da biblioteca
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('play-btn')) {
            const card = e.target.closest('.card');
            const songTitle = card.querySelector('h4').textContent;
            const song = sampleSongs.find(s => s.title === songTitle);
            if (song) {
                playDeezerTrack(song.preview, song.title, song.artist, song.cover);
            }
        }
    });
}

// ===== INICIALIZA√á√ÉO =====
window.addEventListener('DOMContentLoaded', function() {
    const currentUser = sessionStorage.getItem('currentUser');
    if (!currentUser) {
        alert('Por favor, fa√ßa login para acessar esta p√°gina.');
        window.location.href = "login.html";
        return;
    }

    loadPlaylists();
    setupEventListeners();
});

function logout() {
    sessionStorage.removeItem('currentUser');
    window.location.href = "login.html?logout=true";
    return false;
}

// Adiciona estilos CSS
const additionalStyles = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    .album-info {
        color: #888;
        font-size: 0.8rem;
        margin-top: 5px;
    }
    
    .no-results {
        text-align: center;
        padding: 40px;
        color: #bbb;
    }
    
    .search-results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .back-button {
        background: #666;
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.9rem;
    }
    
    .back-button:hover {
        background: #777;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
`;

// Adiciona estilos √† p√°gina
if (!document.getElementById('deezer-styles')) {
    const styleElement = document.createElement('style');
    styleElement.id = 'deezer-styles';
    styleElement.textContent = additionalStyles;
    document.head.appendChild(styleElement);
}   
    </script>
</body>

</html>